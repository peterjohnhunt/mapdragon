!function($){"use strict";function e(){f=new google.maps.Geocoder,v=[],h=new google.maps.LatLng(40,-95);var e={scrollwheel:!1,center:h,zoom:4,disableDefaultUI:!0,zoomControl:!0};d.append('<div id="mapdragon" class="map"></div>'),m=new google.maps.Map(d.find("#mapdragon")[0],e),d.trigger("mapdragon-initialized",[m]),google.maps.event.addDomListener(window,"resize",function(){n()}),g=d.triggerHandler("image"),g&&(p={url:mapdragon_ajax_vars.theme+g,scaledSize:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(16,32)},u={url:mapdragon_ajax_vars.theme+g,scaledSize:new google.maps.Size(48,48),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(24,48)})}function n(e){if(e&&(h=e),d.find(".featured")[0]){var n=(m.getCenter().lng()-m.getBounds().getSouthWest().lng())/2;m.panTo({lat:h.lat,lng:h.lng+n})}else m.panTo(h)}function a(e){d.find(".selected")[0]||d.append('<div class="featured"><div class="close">X</div><div class="selected"></div></div>');var a=d.find(".featured"),t=a.find(".selected");t.empty(),t.append(e.html()),n(e.data());var i=a.find(".close");i.click(function(){o()})}function o(){var e=d.find(".featured");e.remove(),g&&$.each(v,function(){this.setIcon(p)}),n(w)}function t(e){$.each(v,function(){this.setMap(null)}),v=[],s.empty(),m.setZoom(10),n(e)}function i(e){var n=new google.maps.Marker({map:m,position:e});return g&&(n.setIcon(p),n.addListener("click",function(){$.each(v,function(){this.setIcon(p)}),n.setIcon(u)})),n}function c(){var e=l.serialize(),n=[];l.serializeArray().map(function(e){n[e.name]=e.value}),f.geocode({address:n.location},function(o,c){c==google.maps.GeocoderStatus.OK&&(w={lat:o[0].geometry.location.lat(),lng:o[0].geometry.location.lng()},$.ajax({type:"POST",url:mapdragon_ajax_vars.url,data:{action:"mapdragon",nonce:mapdragon_ajax_vars.nonce,values:e,lat:w.lat,lng:w.lng,distance:n.distance},dataType:"json",beforeSend:function(){t(w)},success:function(e){s.append(e.data.html),s.children().each(function(e){var n=$(this),o=i(n.data());o.addListener("click",function(){a(n)}),n.click(function(){a(n)}),v.push(o)})}}))})}var l=$(".mapdragon-form"),r=$("#location"),d=$(".mapdragon-map"),s=$(".mapdragon-view"),g=!1,p={},u={},m,f,v,h,w;l[0]&&d[0]&&s[0]&&($(window).on("load",function(){e(),c()}),l.submit(function(e){e.preventDefault(),c()}))}(jQuery);