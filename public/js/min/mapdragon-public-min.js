!function($){"use strict";function a(){r=new google.maps.Geocoder,g=[],p=new google.maps.LatLng(40,-95);var a={scrollwheel:!1,center:p,zoom:4,disableDefaultUI:!0,zoomControl:!0};d.append('<div id="mapdragon" class="map"></div>'),s=new google.maps.Map(d.find("#mapdragon")[0],a),d.trigger("mapdragon-initialized",[s]),google.maps.event.addDomListener(window,"resize",function(){n()})}function n(a){if(a&&(p=a),d.find(".featured")[0]){var n=(s.getCenter().lng()-s.getBounds().getSouthWest().lng())/2;s.panTo({lat:p.lat,lng:p.lng+n})}else s.panTo(p)}function e(a){d.find(".selected")[0]||d.append('<div class="featured"><div class="close">X</div><div class="selected"></div></div>');var e=d.find(".featured"),t=e.find(".selected");t.empty(),t.append(a.html()),n(a.data());var i=e.find(".close");i.click(function(){o()})}function o(){var a=d.find(".featured");a.remove(),n(m)}function t(){var a=i.serialize(),t=[];i.serializeArray().map(function(a){t[a.name]=a.value}),r.geocode({address:t.location},function(i,l){console.log(l),l==google.maps.GeocoderStatus.OK&&(m={lat:i[0].geometry.location.lat(),lng:i[0].geometry.location.lng()},$.ajax({type:"POST",url:mapdragon_ajax_vars.url,data:{action:"mapdragon",nonce:mapdragon_ajax_vars.nonce,values:a,lat:m.lat,lng:m.lng,distance:t.distance},dataType:"json",success:function(a){$.each(g,function(){this.setMap(null)});var t=new google.maps.Marker({map:s,position:m,animation:google.maps.Animation.DROP,icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"});t.addListener("click",function(){o()}),g.push(t),n(m),s.setZoom(10),c.empty(),c.append(a.data.html),c.children().each(function(a){var n=$(this),o=new google.maps.Marker({map:s,position:n.data(),animation:google.maps.Animation.DROP});o.addListener("click",function(){e(n)}),n.click(function(){e(n)}),g.push(o)})}}))})}var i=$(".mapdragon-form"),l=$("#location"),d=$(".mapdragon-map"),c=$(".mapdragon-view"),s,r,g,p,m;i[0]&&d[0]&&c[0]&&($(window).on("load",function(){a(),t()}),i.submit(function(a){a.preventDefault(),t()}),i.find("select").change(function(a){t()}))}(jQuery);